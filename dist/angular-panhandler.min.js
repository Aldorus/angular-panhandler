/*! angular-panhandler - v0.0.1 - 2013-12-03
* Copyright (c) 2013 ; Licensed  */
!function(){"use strict";function a(a){return a[0].scrollWidth}function b(a){return a[0].scrollHeight}function c(a){return a[0].offsetWidth}function d(a){return a[0].offsetHeight}function e(){var a,b=document.createElement("p"),c={webkitTransform:"-webkit-transform",OTransform:"-o-transform",msTransform:"-ms-transform",MozTransform:"-moz-transform",transform:"transform"};document.body.insertBefore(b,null);for(var d in c)void 0!==b.style[d]&&(b.style[d]="translate3d(1px,1px,1px)",a=window.getComputedStyle(b).getPropertyValue(c[d]));return document.body.removeChild(b),void 0!==a&&a.length>0&&"none"!==a}angular.module("panhandler",[]).directive("panhandler",function(g){function h(a,b){this.$el=a,this.contentWidth=b.contentWidth,this.contentHeight=b.contentHeight,this.curr=[],this.origin=[],this.startPos=[],this.pos=[0,0],this.touch="ontouchstart"in window||window.DocumentTouch&&document instanceof DocumentTouch,this.has3d=e(),this.downEvent=this.touch?"touchstart":"mousedown",this.upEvent=this.touch?"touchend":"mouseup",this.moveEvent=this.touch?"touchmove":"mousemove",this.noTouch=f("user-select","none"),this.startBind=angular.bind(this,this.startDrag),this.endBind=angular.bind(this,this.endDrag),this.updateBind=angular.bind(this,this.updateDrag),this.mouseOutBind=angular.bind(this,this.mouseOut),this.init()}return h.prototype={init:function(){this.$el.css("overflow","hidden"),this.draggable=angular.element('<div class="panhandler-wrap"></div>'),this.draggable.css(this.noTouch),this.contentWidth&&this.draggable.css("width",this.contentWidth),this.grabCursor(),angular.forEach(this.$el.contents(),angular.bind(this,function(a){this.draggable.append(a)})),this.draggable.append('<div style="clear:both;"></div>'),this.$el.append(this.draggable),this.makeInteractive()},tick:function(){this.origin.length&&this.dirty&&(this.updatePosition(),this.dirty=!1),this.loop=window.requestAnimationFrame(angular.bind(this,this.tick))},updatePosition:function(){var a=this.clampX(this.startPos[0]+(this.curr[0]-this.origin[0])),b=this.clampY(this.startPos[1]+(this.curr[1]-this.origin[1]));if(this.pos=[a,b],this.has3d){var c=f("transform","translate3d("+a+"px,"+b+"px, 0)");this.draggable.css(c)}else this.draggable.css("margin-left",a+"px"),this.draggable.css("margin-top",b+"px")},clampX:function(a){return Math.max(Math.min(0,a),this.minX)},clampY:function(a){return Math.max(Math.min(0,a),this.minY)},cacheBounds:function(){this.contentDimensions=[a(this.draggable),b(this.draggable)],this.viewDimensions=[c(this.$el),d(this.$el)],this.minX=Math.min(this.viewDimensions[0]-this.contentDimensions[0],0),this.minY=Math.min(this.viewDimensions[1]-this.contentDimensions[1],0)},startDrag:function(a){this.origin=this.positionFromEvent(a),this.startPos=[this.pos[0],this.pos[1]],this.cacheBounds(),this.grabbingCursor(),g.on(this.moveEvent,this.updateBind),g.on(this.upEvent,this.endBind),this.$el.on("mouseout",this.mouseOutBind),this.updateDrag(a),this.tick()},updateDrag:function(a){var b=this.positionFromEvent(a);(b[0]!==this.curr[0]||b[1]!==this.curr[1])&&(this.dirty=!0,this.curr=[b[0],b[1]])},endDrag:function(){this.origin=[],this.curr=[],this.grabCursor(),g.off(this.moveEvent,this.updateBind),this.$el.off("mouseout",this.mouseOutBind),window.cancelAnimationFrame(this.loop)},positionFromEvent:function(a){return[a.pageX,a.pageY]},makeInteractive:function(){this.draggable.on(this.downEvent,this.startBind),this.$el.on("$destroy",this.destroy)},mouseOut:function(a){var b=a.srcElement,c=b.querySelector&&b.querySelector(".panhandler-wrap");(c||void 0===a.toElement||"HTML"===a.toElement.tagName)&&this.endDrag()},destroy:function(){this.loop&&window.cancelAnimationFrame(this.loop),g.off(this.upEvent,this.endBind)},grabCursor:function(){var a=navigator.userAgent.match(/WebKit/),b=navigator.userAgent.match(/Gecko/);a?this.draggable.css("cursor","-webkit-grab"):b?this.draggable.css("cursor","-moz-grab"):this.draggable.css("cursor","move")},grabbingCursor:function(){var a=navigator.userAgent.match(/WebKit/),b=navigator.userAgent.match(/Gecko/);a?this.draggable.css("cursor","-webkit-grabbing"):b?this.draggable.css("cursor","-moz-grabbing"):this.draggable.css("cursor","move")}},{link:function(a,b,c){setTimeout(function(){new h(b,c)})}}});var f=function(){var a=["-webkit-","-moz-","-ms-",""];return function(b,c){var d={};return angular.forEach(a,function(a){d[a+b]=c}),d}}();!function(){for(var a=0,b=["webkit","moz"],c=0;c<b.length&&!window.requestAnimationFrame;++c)window.requestAnimationFrame=window[b[c]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[b[c]+"CancelAnimationFrame"]||window[b[c]+"CancelRequestAnimationFrame"];window.requestAnimationFrame||(window.requestAnimationFrame=function(b){var c=(new Date).getTime(),d=Math.max(0,16-(c-a)),e=window.setTimeout(function(){b(c+d)},d);return a=c+d,e}),window.cancelAnimationFrame||(window.cancelAnimationFrame=function(a){clearTimeout(a)})}()}();